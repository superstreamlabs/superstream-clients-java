name: Trigger Jenkins Job

on:
  push:
    branches:
      - remove-jenkinsfile
    # paths:
    #   - superstream-clients/pom.xml

jobs:
  trigger-jenkins:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Trigger Jenkins Job
        env:
          JENKINS_TOKEN: ${{ secrets.JENKINS_TOKEN }}
        run: |
          HTTP_STATUS=$(curl -w "%{http_code}" -o /tmp/jenkins_response.txt -f -X POST \
            "https://jenkins.superstream.ai/job/DevOps/jobi/Superstream/job/SDK/job/superstream-clients-java/buildWithParameters?DEPLOYMENT_TYPE=production" \
            --user "team@superstream.ai:$JENKINS_TOKEN")
          
          if [ $? -ne 0 ] || [ "$HTTP_STATUS" -ne 201 ] && [ "$HTTP_STATUS" -ne 200 ]; then
            echo "Jenkins trigger failed with HTTP status: $HTTP_STATUS"
            cat /tmp/jenkins_response.txt
            exit 1
          fi
          
          echo "Successfully triggered Jenkins build (HTTP $HTTP_STATUS)"     